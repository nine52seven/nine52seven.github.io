var SIM=SIM||{};SIM.STATS={init:function(){this.variables(),this.events()},variables:function(){this.body=$("body"),this.stats=this.body.find("section.stats"),this.dmg=this.stats.find(".container-dmg canvas"),this.dmglegend=this.stats.find(".container-dmg").siblings(".legend"),this.aura=this.stats.find(".container-aura canvas"),this.spread=this.stats.find(".container-spread canvas"),this.colors=["#003f5c","#2f4b7c","#665191","#a05195","#d45087","#f95d6a","#ff7c43","#ffa600"],this.close=this.stats.find(".btn-close"),this.table=this.stats.find(".container-table")},events:function(){this.close.click(function(t){t.preventDefault(),$(".js-stats").removeClass("active"),$("section.stats").removeClass("active")})},initCharts:function(t){$(".js-stats").removeClass("disabled"),this.buildTable(t),this.buildData(t),this.buildAuras(),this.buildDamage(),this.buildSpread()},buildData:function(t){let a=0,s=[],e=[];this.auradata={labels:[],datasets:[]};for(let d in t.player.auras){let i=t.player.auras[d];i.uptime&&(this.auradata.labels.push(i.name),s.push((i.uptime/t.totalduration/10).toFixed(2)),e.push(this.colors[a%this.colors.length]),a++)}this.auradata.datasets.push({data:s,fill:!1,backgroundColor:e}),a=0,s=[],e=[],this.dmgdata={labels:[],datasets:[]};for(let d in t.player.spells){let i=t.player.spells[d];i.totaldmg&&(this.dmgdata.labels.push(i.name),s.push((i.totaldmg/t.totalduration).toFixed(2)),e.push(this.colors[a%this.colors.length]),a++)}this.dmgdata.labels.push("Main Hand"),s.push((t.player.mh.totaldmg/t.totalduration).toFixed(2)),e.push(this.colors[a%this.colors.length]),a++,t.player.mh.totalprocdmg&&(this.dmgdata.labels.push("Main Hand Proc"),s.push((t.player.mh.totalprocdmg/t.totalduration).toFixed(2)),e.push(this.colors[a%this.colors.length]),a++),t.player.oh&&(this.dmgdata.labels.push("Off Hand"),s.push((t.player.oh.totaldmg/t.totalduration).toFixed(2)),e.push(this.colors[a%this.colors.length]),a++,t.player.oh.totalprocdmg&&(this.dmgdata.labels.push("Off Hand Proc"),s.push((t.player.oh.totalprocdmg/t.totalduration).toFixed(2)),e.push(this.colors[a%this.colors.length]),a++)),t.player.auras.deepwounds&&t.player.auras.deepwounds.totaldmg&&(this.dmgdata.labels.push(t.player.auras.deepwounds.name),s.push((t.player.auras.deepwounds.totaldmg/t.totalduration).toFixed(2)),e.push(this.colors[a%this.colors.length])),this.dmgdata.datasets.push({data:s,fill:!1,backgroundColor:e}),s=[],this.spreaddata={labels:[],datasets:[]};for(let a in t.spread)this.spreaddata.labels.push(a),s.push(t.spread[a]);this.spreaddata.datasets.push({data:s,backgroundColor:"rgba(255, 99, 132, 0.5)",borderColor:"rgb(255, 99, 132)",fill:"origin"})},buildAuras:function(){this.aurachart&&this.aurachart.destroy(),this.aurachart=new Chart(this.aura,{type:"horizontalBar",data:this.auradata,showTooltips:!1,options:{responsive:!0,maintainAspectRatio:!1,legend:{display:!1,align:"center",fullWidth:!0},tooltips:{enabled:!1},hover:{mode:null},title:{display:!1,text:"Aura Uptime",fontColor:"#ccc",position:"bottom"},scales:{yAxes:[{ticks:{fontColor:"#ccc"},gridLines:{display:!1}}],xAxes:[{ticks:{beginAtZero:!0,min:0,display:!1},gridLines:{display:!1}}]},animation:{onComplete:function(){var t=this.chart,a=this.chart.ctx;this.data.datasets.forEach(function(s,e){t.controller.getDatasetMeta(e).data.forEach(function(t,e){var d=s.data[e];a.fillStyle="#ddd",a.shadowOffsetX=2,a.shadowOffsetY=2,a.shadowColor="rgba(0,0,0,0.5)",a.shadowBlur=4,a.fillText(d+"%",parseInt(d)<11?t._model.x+10:t._model.x-50,t._model.y+5)})})}}}})},buildDamage:function(){this.dmgchart&&this.dmgchart.destroy(),this.dmgchart=new Chart(this.dmg,{type:"pie",data:this.dmgdata,options:{elements:{arc:{borderWidth:1}},responsive:!0,maintainAspectRatio:!1,title:{display:!1,text:"DPS",fontColor:"#ccc",position:"bottom"},animation:{animateScale:!0,animateRotate:!0},legend:{display:!1,position:"bottom",labels:{fontColor:"#ccc"}},tooltips:{callbacks:{label:(t,a)=>` ${a.labels[t.index]}: ${a.datasets[0].data[t.index]} DPS`}}}}),this.dmglegend.html(this.dmgchart.generateLegend())},buildTable:function(t){this.table.empty();let a="<table><thead><tr><th>Action</th><th>Hit %</th><th>Crit %</th><th>Miss %</th><th>Dodge %</th><th>Glance %</th><th>Uses</th><th>DPS</th></tr></thead><tbody>",s=t.iterations,e=t.player.mh.data,d=e.reduce((t,a)=>t+a,0),i=(t.player.mh.totaldmg/t.totalduration).toFixed(2);a+=`<tr><td>Main Hand</td><td>${(e[0]/d*100).toFixed(2)}</td><td>${(e[3]/d*100).toFixed(2)}</td><td>${(e[1]/d*100).toFixed(2)}</td><td>${(e[2]/d*100).toFixed(2)}</td><td>${(e[4]/d*100).toFixed(2)}</td><td>${(d/s).toFixed(2)}</td><td>${i}</td></tr>`,t.player.oh&&(d=(e=t.player.oh.data).reduce((t,a)=>t+a,0),i=(t.player.oh.totaldmg/t.totalduration).toFixed(2),a+=`<tr><td>Off Hand</td><td>${(e[0]/d*100).toFixed(2)}</td><td>${(e[3]/d*100).toFixed(2)}</td><td>${(e[1]/d*100).toFixed(2)}</td><td>${(e[2]/d*100).toFixed(2)}</td><td>${(e[4]/d*100).toFixed(2)}</td><td>${(d/s).toFixed(2)}</td><td>${i}</td></tr>`);for(let e in t.player.spells){let d=t.player.spells[e].name,i=t.player.spells[e].data,o=i.reduce((t,a)=>t+a,0);if(!o)continue;let l=(t.player.spells[e].totaldmg/t.totalduration).toFixed(2);a+=`<tr><td>${d}</td><td>${(i[0]/o*100).toFixed(2)}</td><td>${(i[3]/o*100).toFixed(2)}</td><td>${(i[1]/o*100).toFixed(2)}</td><td>${(i[2]/o*100).toFixed(2)}</td><td>${(i[4]/o*100).toFixed(2)}</td><td>${(o/s).toFixed(2)}</td><td>${l}</td></tr>`}a+="</tbody></table>",this.table.append(a),this.table.find("table").tablesorter({widthFixed:!0})},buildSpread:function(){this.spreadchart&&this.spreadchart.destroy(),this.spreadchart=new Chart(this.spread,{type:"bar",data:this.spreaddata,options:{responsive:!0,maintainAspectRatio:!1,spanGaps:!1,legend:{display:!1},elements:{line:{tension:.4},point:{radius:0}},plugins:{filler:{propagate:!1}},scales:{xAxes:[{ticks:{beginAtZero:!0,autoSkip:!0,maxRotation:0}}]},tooltips:{callbacks:{label:(t,a)=>` ${a.labels[t.index]} DPS: ${a.datasets[0].data[t.index]}`}}}})}};